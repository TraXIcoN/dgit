<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8" /> <meta http-equiv="X-UA-Compatible" content="IE=Edge" /> <meta name="viewport" content="width=device-width, initial-scale=1" /> <title> API Reference - dGit Documentation </title> <link rel="stylesheet" href="/dgit/assets/css/main.css" /> <script src="/dgit/assets/js/vendor/lunr.min.js"></script> <script src="/dgit/assets/js/just-the-docs.js"></script> </head> <body> <div class="page-wrap"> <div class="side-bar"> <div class="site-header"> <a href="/dgit/" class="site-title lh-tight" >dGit Documentation</a > </div> <nav aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list"><li class="nav-list-item"> <a href="http://localhost:4000/dgit/" class="nav-list-link" >Home</a > </li><li class="nav-list-item"> <a href="http://localhost:4000/dgit/architecture/storage.html" class="nav-list-link" >Storage Implementation</a > </li><li class="nav-list-item"> <a href="http://localhost:4000/dgit/getting-started.html" class="nav-list-link" >Getting Started with dGit</a > </li><li class="nav-list-item"> <a href="http://localhost:4000/dgit/architecture/" class="nav-list-link" >dGit Architecture</a > </li><li class="nav-list-item active"> <a href="http://localhost:4000/dgit/api-reference.html" class="nav-list-link" >API Reference</a > </li><li class="nav-list-item"> <a href="http://localhost:4000/dgit/workflows.html" class="nav-list-link" >Example Workflows</a > </li><li class="nav-list-item"> <a href="http://localhost:4000/dgit/troubleshooting.html" class="nav-list-link" >Troubleshooting Guide</a > </li></ul> </nav> </div> <div class="main" id="top"> <div class="main-content-wrap"> <div class="main-content"> <div class="page-header"> <h1>API Reference</h1> </div> <h2 id="core-api">Core API</h2> <h3 id="repository-operations">Repository Operations</h3> <h4 id="initrepo"><code class="language-plaintext highlighter-rouge">initRepo()</code></h4> <p>Initializes a new dGit repository in the current directory.</p> <div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">async</span> <span class="kd">function</span> <span class="nf">initRepo</span><span class="p">():</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="k">void</span><span class="o">&gt;</span><span class="p">;</span>
</code></pre></div></div> <p><strong>Example:</strong></p> <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">initRepo</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">dgit/core</span><span class="dl">"</span><span class="p">;</span>

<span class="k">await</span> <span class="nf">initRepo</span><span class="p">();</span>
<span class="c1">// Creates .dgit directory with initial structure</span>
</code></pre></div></div> <h4 id="addfilesfiles-string"><code class="language-plaintext highlighter-rouge">addFiles(files: string[])</code></h4> <p>Stages files for commit.</p> <div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">async</span> <span class="kd">function</span> <span class="nf">addFiles</span><span class="p">(</span><span class="nx">files</span><span class="p">:</span> <span class="kr">string</span><span class="p">[]):</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="k">void</span><span class="o">&gt;</span><span class="p">;</span>
</code></pre></div></div> <p><strong>Parameters:</strong></p> <ul> <li><code class="language-plaintext highlighter-rouge">files</code>: Array of file paths to stage</li> </ul> <p><strong>Example:</strong></p> <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">addFiles</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">dgit/core</span><span class="dl">"</span><span class="p">;</span>

<span class="c1">// Add single file</span>
<span class="k">await</span> <span class="nf">addFiles</span><span class="p">([</span><span class="dl">"</span><span class="s2">file.txt</span><span class="dl">"</span><span class="p">]);</span>

<span class="c1">// Add multiple files</span>
<span class="k">await</span> <span class="nf">addFiles</span><span class="p">([</span><span class="dl">"</span><span class="s2">file1.txt</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">file2.txt</span><span class="dl">"</span><span class="p">]);</span>

<span class="c1">// Add with glob pattern</span>
<span class="k">await</span> <span class="nf">addFiles</span><span class="p">([</span><span class="dl">"</span><span class="s2">src/*.js</span><span class="dl">"</span><span class="p">]);</span>
</code></pre></div></div> <h4 id="createcommitoptions"><code class="language-plaintext highlighter-rouge">createCommit(options)</code></h4> <p>Creates a new commit with staged changes.</p> <div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kr">interface</span> <span class="nx">CommitOptions</span> <span class="p">{</span>
  <span class="nl">message</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">async</span> <span class="kd">function</span> <span class="nf">createCommit</span><span class="p">(</span><span class="nx">options</span><span class="p">:</span> <span class="nx">CommitOptions</span><span class="p">):</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="kr">string</span><span class="o">&gt;</span><span class="p">;</span>
</code></pre></div></div> <p><strong>Parameters:</strong></p> <ul> <li><code class="language-plaintext highlighter-rouge">options.message</code>: Commit message</li> </ul> <p><strong>Returns:</strong></p> <ul> <li>Commit hash</li> </ul> <p><strong>Example:</strong></p> <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">createCommit</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">dgit/core</span><span class="dl">"</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">hash</span> <span class="o">=</span> <span class="k">await</span> <span class="nf">createCommit</span><span class="p">({</span>
  <span class="na">message</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Initial commit</span><span class="dl">"</span><span class="p">,</span>
<span class="p">});</span>
<span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="s2">`Created commit: </span><span class="p">${</span><span class="nx">hash</span><span class="p">}</span><span class="s2">`</span><span class="p">);</span>
</code></pre></div></div> <h2 id="storage-api">Storage API</h2> <h3 id="class-storage">Class: Storage</h3> <h4 id="constructor">Constructor</h4> <div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">constructor</span><span class="p">(</span><span class="nx">repoPath</span><span class="p">?:</span> <span class="kr">string</span><span class="p">)</span>
</code></pre></div></div> <p><strong>Parameters:</strong></p> <ul> <li><code class="language-plaintext highlighter-rouge">repoPath</code>: Optional repository path (defaults to ‘.dgit’)</li> </ul> <h4 id="methods">Methods</h4> <h5 id="init"><code class="language-plaintext highlighter-rouge">init()</code></h5> <p>Initializes the storage database.</p> <div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">async</span> <span class="nf">init</span><span class="p">():</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="k">void</span><span class="o">&gt;</span>
</code></pre></div></div> <h5 id="savecommithash-data"><code class="language-plaintext highlighter-rouge">saveCommit(hash, data)</code></h5> <p>Stores a commit object.</p> <div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kr">interface</span> <span class="nx">CommitData</span> <span class="p">{</span>
  <span class="nl">tree</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>
  <span class="nl">parent</span><span class="p">:</span> <span class="kr">string</span> <span class="o">|</span> <span class="kc">null</span><span class="p">;</span>
  <span class="nl">author</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>
  <span class="nl">timestamp</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>
  <span class="nl">message</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>
  <span class="nl">signature</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">async</span> <span class="nf">saveCommit</span><span class="p">(</span><span class="nx">hash</span><span class="p">:</span> <span class="kr">string</span><span class="p">,</span> <span class="nx">data</span><span class="p">:</span> <span class="nx">CommitData</span><span class="p">):</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="k">void</span><span class="o">&gt;</span>
</code></pre></div></div> <h5 id="getcommithash"><code class="language-plaintext highlighter-rouge">getCommit(hash)</code></h5> <p>Retrieves a commit object.</p> <div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">async</span> <span class="nf">getCommit</span><span class="p">(</span><span class="nx">hash</span><span class="p">:</span> <span class="kr">string</span><span class="p">):</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">CommitData</span> <span class="o">|</span> <span class="kc">null</span><span class="o">&gt;</span>
</code></pre></div></div> <h5 id="getcommithistory"><code class="language-plaintext highlighter-rouge">getCommitHistory()</code></h5> <p>Gets the ordered list of commit hashes.</p> <div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">async</span> <span class="nf">getCommitHistory</span><span class="p">():</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="kr">string</span><span class="p">[]</span><span class="o">&gt;</span>
</code></pre></div></div> <h5 id="saveobjecthash-content"><code class="language-plaintext highlighter-rouge">saveObject(hash, content)</code></h5> <p>Stores a blob or tree object.</p> <div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">async</span> <span class="nf">saveObject</span><span class="p">(</span><span class="nx">hash</span><span class="p">:</span> <span class="kr">string</span><span class="p">,</span> <span class="nx">content</span><span class="p">:</span> <span class="kr">any</span><span class="p">):</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="k">void</span><span class="o">&gt;</span>
</code></pre></div></div> <h5 id="getobjecthash"><code class="language-plaintext highlighter-rouge">getObject(hash)</code></h5> <p>Retrieves an object by hash.</p> <div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">async</span> <span class="nf">getObject</span><span class="p">(</span><span class="nx">hash</span><span class="p">:</span> <span class="kr">string</span><span class="p">):</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="kr">any</span> <span class="o">|</span> <span class="kc">null</span><span class="o">&gt;</span>
</code></pre></div></div> <h5 id="saveindexdata"><code class="language-plaintext highlighter-rouge">saveIndex(data)</code></h5> <p>Updates the staging area.</p> <div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kr">interface</span> <span class="nx">IndexData</span> <span class="p">{</span>
  <span class="nl">files</span><span class="p">:</span> <span class="p">{</span>
    <span class="p">[</span><span class="na">path</span><span class="p">:</span> <span class="kr">string</span><span class="p">]:</span> <span class="p">{</span>
      <span class="na">hash</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>
      <span class="nl">size</span><span class="p">:</span> <span class="kr">number</span><span class="p">;</span>
      <span class="nl">timestamp</span><span class="p">:</span> <span class="kr">number</span><span class="p">;</span>
      <span class="nl">type</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>
      <span class="nl">mode</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="k">async</span> <span class="nf">saveIndex</span><span class="p">(</span><span class="nx">data</span><span class="p">:</span> <span class="nx">IndexData</span><span class="p">):</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="k">void</span><span class="o">&gt;</span>
</code></pre></div></div> <h5 id="getindex"><code class="language-plaintext highlighter-rouge">getIndex()</code></h5> <p>Gets the current staging area state.</p> <div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">async</span> <span class="nf">getIndex</span><span class="p">():</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">IndexData</span><span class="o">&gt;</span>
</code></pre></div></div> <h2 id="usage-examples">Usage Examples</h2> <h3 id="basic-repository-operations">Basic Repository Operations</h3> <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">initRepo</span><span class="p">,</span> <span class="nx">addFiles</span><span class="p">,</span> <span class="nx">createCommit</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">dgit/core</span><span class="dl">"</span><span class="p">;</span>

<span class="c1">// Initialize repository</span>
<span class="k">await</span> <span class="nf">initRepo</span><span class="p">();</span>

<span class="c1">// Stage files</span>
<span class="k">await</span> <span class="nf">addFiles</span><span class="p">([</span><span class="dl">"</span><span class="s2">README.md</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">src/*.js</span><span class="dl">"</span><span class="p">]);</span>

<span class="c1">// Create commit</span>
<span class="kd">const</span> <span class="nx">hash</span> <span class="o">=</span> <span class="k">await</span> <span class="nf">createCommit</span><span class="p">({</span>
  <span class="na">message</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Initial commit</span><span class="dl">"</span><span class="p">,</span>
<span class="p">});</span>
</code></pre></div></div> <h3 id="working-with-storage-directly">Working with Storage Directly</h3> <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">getStorage</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">dgit/storage</span><span class="dl">"</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">storage</span> <span class="o">=</span> <span class="nf">getStorage</span><span class="p">();</span>
<span class="k">await</span> <span class="nx">storage</span><span class="p">.</span><span class="nf">init</span><span class="p">();</span>

<span class="c1">// Save a blob</span>
<span class="kd">const</span> <span class="nx">content</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">Hello, World!</span><span class="dl">"</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">hash</span> <span class="o">=</span> <span class="nf">computeHash</span><span class="p">(</span><span class="nx">content</span><span class="p">);</span>
<span class="k">await</span> <span class="nx">storage</span><span class="p">.</span><span class="nf">saveObject</span><span class="p">(</span><span class="nx">hash</span><span class="p">,</span> <span class="nx">content</span><span class="p">);</span>

<span class="c1">// Retrieve commit history</span>
<span class="kd">const</span> <span class="nx">history</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">storage</span><span class="p">.</span><span class="nf">getCommitHistory</span><span class="p">();</span>
<span class="k">for </span><span class="p">(</span><span class="kd">const</span> <span class="nx">commitHash</span> <span class="k">of</span> <span class="nx">history</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">commit</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">storage</span><span class="p">.</span><span class="nf">getCommit</span><span class="p">(</span><span class="nx">commitHash</span><span class="p">);</span>
  <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="s2">`</span><span class="p">${</span><span class="nx">commitHash</span><span class="p">}</span><span class="s2">: </span><span class="p">${</span><span class="nx">commit</span><span class="p">.</span><span class="nx">message</span><span class="p">}</span><span class="s2">`</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div> <h2 id="error-handling">Error Handling</h2> <p>All API methods may throw errors that should be handled:</p> <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">try</span> <span class="p">{</span>
  <span class="k">await</span> <span class="nf">addFiles</span><span class="p">([</span><span class="dl">"</span><span class="s2">nonexistent.txt</span><span class="dl">"</span><span class="p">]);</span>
<span class="p">}</span> <span class="k">catch </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nf">error</span><span class="p">(</span><span class="dl">"</span><span class="s2">Failed to add files:</span><span class="dl">"</span><span class="p">,</span> <span class="nx">error</span><span class="p">.</span><span class="nx">message</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div> <p>Common error types:</p> <ul> <li><code class="language-plaintext highlighter-rouge">RepositoryError</code>: Repository-related issues</li> <li><code class="language-plaintext highlighter-rouge">StorageError</code>: Database or filesystem errors</li> <li><code class="language-plaintext highlighter-rouge">ValidationError</code>: Invalid input parameters</li> </ul> <h2 id="type-definitions">Type Definitions</h2> <p>For TypeScript users, type definitions are available:</p> <div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">CommitOptions</span><span class="p">,</span> <span class="nx">CommitData</span><span class="p">,</span> <span class="nx">IndexData</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">dgit/types</span><span class="dl">"</span><span class="p">;</span>
</code></pre></div></div> <h2 id="next-steps">Next Steps</h2> <ul> <li>See <a href="./workflows">Example Workflows</a></li> <li>Check <a href="./troubleshooting">Troubleshooting</a></li> <li>Review <a href="./architecture">Architecture</a></li> </ul> <hr /> <footer> <p class="text-small text-grey-dk-000 mb-0"> Copyright &copy; 2024. Distributed under an MIT license. </p> </footer> </div> </div> </div> </div> <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script> <script> document.addEventListener("DOMContentLoaded", function () { mermaid.initialize({ startOnLoad: true, theme: "dark", securityLevel: "loose", themeVariables: { background: "#161b22", primaryColor: "#238636", secondaryColor: "#58a6ff", tertiaryColor: "#30363d", fontFamily: 'system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI"', }, }); document .querySelectorAll("pre code.language-mermaid") .forEach(function (element) { const div = document.createElement("div"); div.className = "mermaid"; div.textContent = element.textContent; element.parentElement.replaceWith(div); }); }); </script> </body> </html>
