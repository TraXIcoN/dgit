<h1 id="dgit-architecture">dGit Architecture</h1>

<h2 id="system-overview">System Overview</h2>

<p>dGit is built with a layered architecture that separates concerns and promotes modularity.</p>

<pre><code class="language-mermaid">graph TD
    A[CLI Layer] --&gt; B[Core Layer]
    B --&gt; C[Storage Layer]
    C --&gt; D[LevelDB]
    C --&gt; E[File System]
    style A fill:#f9f,stroke:#333
    style B fill:#bbf,stroke:#333
    style C fill:#dfd,stroke:#333
</code></pre>

<h2 id="core-components">Core Components</h2>

<h3 id="1-cli-layer">1. CLI Layer</h3>

<ul>
  <li><strong>Purpose</strong>: Handles user interaction and command parsing</li>
  <li><strong>Location</strong>: <code class="language-plaintext highlighter-rouge">src/cli/</code></li>
  <li><strong>Key Components</strong>:
    <ul>
      <li>Command parser</li>
      <li>User input validation</li>
      <li>Output formatting</li>
    </ul>
  </li>
</ul>

<h3 id="2-core-layer">2. Core Layer</h3>

<ul>
  <li><strong>Purpose</strong>: Implements core version control logic</li>
  <li><strong>Location</strong>: <code class="language-plaintext highlighter-rouge">src/core/</code></li>
  <li><strong>Key Components</strong>:
    <ul>
      <li>Repository initialization (<code class="language-plaintext highlighter-rouge">init.js</code>)</li>
      <li>File staging (<code class="language-plaintext highlighter-rouge">add.js</code>)</li>
      <li>Commit creation (<code class="language-plaintext highlighter-rouge">commit.js</code>)</li>
      <li>Object model implementation</li>
    </ul>
  </li>
</ul>

<h3 id="3-storage-layer">3. Storage Layer</h3>

<ul>
  <li><strong>Purpose</strong>: Manages data persistence</li>
  <li><strong>Location</strong>: <code class="language-plaintext highlighter-rouge">src/storage/</code></li>
  <li><strong>Key Components</strong>:
    <ul>
      <li>LevelDB integration</li>
      <li>Object storage</li>
      <li>Index management</li>
    </ul>
  </li>
</ul>

<h2 id="data-model">Data Model</h2>

<h3 id="objects">Objects</h3>

<p>dGit uses three types of objects:</p>

<ol>
  <li>
    <p><strong>Blobs</strong></p>

    <ul>
      <li>Store file contents</li>
      <li>Content-addressable by SHA-1 hash</li>
    </ul>

    <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span>
  <span class="nl">type</span><span class="p">:</span> <span class="dl">'</span><span class="s1">blob</span><span class="dl">'</span><span class="p">,</span>
  <span class="nx">content</span><span class="p">:</span> <span class="nx">Buffer</span>
<span class="p">}</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p><strong>Trees</strong></p>

    <ul>
      <li>Represent directories</li>
      <li>Contains references to blobs and other trees</li>
    </ul>

    <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span>
  <span class="nl">type</span><span class="p">:</span> <span class="dl">'</span><span class="s1">tree</span><span class="dl">'</span><span class="p">,</span>
  <span class="nx">entries</span><span class="p">:</span> <span class="p">{</span>
    <span class="dl">'</span><span class="s1">filename</span><span class="dl">'</span><span class="p">:</span> <span class="p">{</span> <span class="nl">type</span><span class="p">:</span> <span class="dl">'</span><span class="s1">blob</span><span class="dl">'</span><span class="p">,</span> <span class="nx">hash</span><span class="p">:</span> <span class="dl">'</span><span class="s1">sha1</span><span class="dl">'</span> <span class="p">},</span>
    <span class="dl">'</span><span class="s1">dirname</span><span class="dl">'</span><span class="p">:</span> <span class="p">{</span> <span class="nl">type</span><span class="p">:</span> <span class="dl">'</span><span class="s1">tree</span><span class="dl">'</span><span class="p">,</span> <span class="nx">hash</span><span class="p">:</span> <span class="dl">'</span><span class="s1">sha1</span><span class="dl">'</span> <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p><strong>Commits</strong></p>
    <ul>
      <li>Represent snapshots</li>
      <li>Include metadata and cryptographic signatures
        <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span>
<span class="nl">type</span><span class="p">:</span> <span class="dl">'</span><span class="s1">commit</span><span class="dl">'</span><span class="p">,</span>
<span class="nx">tree</span><span class="p">:</span> <span class="dl">'</span><span class="s1">sha1</span><span class="dl">'</span><span class="p">,</span>
<span class="nx">parent</span><span class="p">:</span> <span class="dl">'</span><span class="s1">sha1</span><span class="dl">'</span><span class="p">,</span>
<span class="nx">author</span><span class="p">:</span> <span class="dl">'</span><span class="s1">string</span><span class="dl">'</span><span class="p">,</span>
<span class="nx">message</span><span class="p">:</span> <span class="dl">'</span><span class="s1">string</span><span class="dl">'</span><span class="p">,</span>
<span class="nx">timestamp</span><span class="p">:</span> <span class="dl">'</span><span class="s1">ISO string</span><span class="dl">'</span><span class="p">,</span>
<span class="nx">signature</span><span class="p">:</span> <span class="dl">'</span><span class="s1">string</span><span class="dl">'</span>
<span class="p">}</span>
</code></pre></div>        </div>
      </li>
    </ul>
  </li>
</ol>

<h2 id="data-flow">Data Flow</h2>

<h3 id="adding-files">Adding Files</h3>

<pre><code class="language-mermaid">sequenceDiagram
    participant User
    participant CLI
    participant Core
    participant Storage

    User-&gt;&gt;CLI: dgit add file.txt
    CLI-&gt;&gt;Core: addFiles(['file.txt'])
    Core-&gt;&gt;Storage: createBlob(content)
    Storage--&gt;&gt;Core: blobHash
    Core-&gt;&gt;Storage: updateIndex(fileInfo)
    Storage--&gt;&gt;Core: success
    Core--&gt;&gt;CLI: success
    CLI--&gt;&gt;User: "Added file.txt"
</code></pre>

<h3 id="creating-commits">Creating Commits</h3>

<pre><code class="language-mermaid">sequenceDiagram
    participant User
    participant Core
    participant Storage
    participant Crypto

    User-&gt;&gt;Core: createCommit(message)
    Core-&gt;&gt;Storage: getIndex()
    Storage--&gt;&gt;Core: stagedFiles
    Core-&gt;&gt;Core: buildTree()
    Core-&gt;&gt;Crypto: signCommit()
    Core-&gt;&gt;Storage: saveCommit()
    Storage--&gt;&gt;Core: commitHash
    Core--&gt;&gt;User: "Created commit [hash]"
</code></pre>

<h2 id="security">Security</h2>

<h3 id="cryptographic-verification">Cryptographic Verification</h3>

<ul>
  <li>RSA key pair generation on init</li>
  <li>Commit signing with private key</li>
  <li>Verification with public key</li>
  <li>SHA-1 hashing for content addressing</li>
</ul>

<h2 id="performance-considerations">Performance Considerations</h2>

<h3 id="storage-optimization">Storage Optimization</h3>

<ul>
  <li>Content-addressable storage prevents duplication</li>
  <li>LevelDB for efficient key-value operations</li>
  <li>Lazy loading of objects</li>
  <li>Batch operations for better performance</li>
</ul>

<h2 id="next-steps">Next Steps</h2>

<ul>
  <li>Learn about the <a href="./storage">Storage Implementation</a></li>
  <li>View the <a href="../api-reference">API Reference</a></li>
  <li>Check <a href="../workflows">Example Workflows</a></li>
</ul>
